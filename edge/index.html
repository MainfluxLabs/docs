<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://mainfluxlabs.github.io/edge/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Edge - MainfluxLabs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Edge";
        var mkdocs_page_input_path = "edge.md";
        var mkdocs_page_url = "/edge/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> MainfluxLabs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../provision.md">Provision</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../messaging/">Messaging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Edge</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#agent">Agent</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#run-agent">Run Agent</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#remote-execution-of-commands-via-agent">Remote execution of commands via Agent</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#remote-terminal">Remote terminal</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#heartbeat">Heartbeat</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#proxying-commands">Proxying commands</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#edgex">EdgeX</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#remote-commands">Remote Commands</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#export">Export</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#install">Install</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment variables</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#http-port">Http port</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#mqtt-connection">MQTT connection</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#mtls">MTLS</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#routes">Routes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-save-config-via-agent">How to save config via agent</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-configure-script">Using configure script</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-deployment">Example deployment</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#edge-deployment">Edge deployment</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#services-in-the-cloud">Services in the cloud</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#services-on-the-edge">Services on the Edge</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#agent_1">Agent</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#export_1">Export</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#testing-export">Testing Export</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../authentication/">Authentication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../authorization/">Authorization</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cli/">CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tracing/">Tracing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../dev-guide/">Developer's Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubernetes/">Kubernetes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmark/">Benchmark</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">MainfluxLabs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Edge</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="edge">Edge<a class="headerlink" href="#edge" title="Permanent link">#</a></h1>
<p>Mainflux IoT platform provides services for supporting management of devices on the edge. Typically, IoT solution includes devices (sensors/actuators) deployed in far edge and connected through some proxy gateway.
Although most devices could be connected to the Mainflux directly, using gateways decentralizes system, decreases load on the cloud and makes setup less difficult. Also, gateways can provide additional data processing, filtering and storage.</p>
<p>Services that can be used on gateway to enable data and control plane for edge:</p>
<ul>
<li><a href="/edge/#agent">Agent</a></li>
<li><a href="/edge/#export">Export</a></li>
<li><a href="/architecture/">Mainflux</a></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: center;"><img alt="Edge1" src="../img/edge/edge.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><b>Figure 1 - Edge services deployment</b></td>
</tr>
</tbody>
</table>
<p>Figure shows edge gateway that is running Agent, Export and minimal deployment of Mainflux services.
Mainflux services enable device management and MQTT protocol, NATS being a central message bus in Mainflux becomes also central message bus for other services like <code>Agent</code> and <code>Export</code> as well as for any new custom developed service that can be built to interface with devices with any of hardware supported interfaces on the gateway, those services would publish data to NATS where <code>Export</code> service can pick them up and send to cloud.</p>
<p>Agent can be used to control deployed services as well as to monitor their liveliness through subcribing to <code>heartbeat</code> NATS subject where services should publish their liveliness status, like <code>Export</code> service does.</p>
<h2 id="agent">Agent<a class="headerlink" href="#agent" title="Permanent link">#</a></h2>
<p>Agent is service that is used to manage gateways that are connected to Mainflux in cloud. It provides a way to send commands to gateway and receive response via mqtt.
There are two types of channels used for <strong>Agent</strong> <code>data</code> and <code>control</code>. Over the <code>control</code> we are sending commands and receiving response from commands.
Data collected from sensors connected to gateway are being sent over <code>data</code> channel. Agent is able to configure itself provided that <a href="/bootstrap/">bootstrap server</a> is running, it will retrieve configuration from bootstrap server provided few arguments - <code>external_id</code> and <code>external_key</code> see <a href="/bootstrap/#bootstrapping">bootstraping</a>.</p>
<p>Agent service has following features:
* Remote execution of commands
* Remote terminal, remote session to <code>bash</code> managed by <code>Agent</code>
* Heartbeat - listening to NATS topic <code>heartbeat.&gt;</code> it can remotely provide info on running services, if services are publishing heartbeat ( like <a href="/edge/#export">Export</a>)
* Proxying commands to other gateway services
* Edgex SMA - remotely making requests to EdgeX endpoints and fetching results, if EdgeX is deployed.</p>
<h3 id="run-agent">Run Agent<a class="headerlink" href="#run-agent" title="Permanent link">#</a></h3>
<p>Before running agent we need to provision a thing and DATA and CONTROL channel. Thing that will be used as gateway representation and make bootstrap configuration.
If using Mainflux UI this is done automatically when adding gateway through UI.
Gateway can be provisioned with <a href="/provision/"><code>provision</code></a> service.</p>
<p>When you provisioned gateway as described in <a href="/provision/">provision</a> you can check results</p>
<pre><code class="language-bash">curl -s -S -X GET http://mainflux-domain.com:8202/things/bootstrap/&lt;external_id&gt; -H &quot;Authorization: Thing &lt;external_key&gt;&quot; -H 'Content-Type: application/json' |jq
</code></pre>
<pre><code class="language-json">{
  &quot;mainflux_id&quot;: &quot;e22c383a-d2ab-47c1-89cd-903955da993d&quot;,
  &quot;mainflux_key&quot;: &quot;fc987711-1828-461b-aa4b-16d5b2c642fe&quot;,
  &quot;mainflux_channels&quot;: [
    {
      &quot;id&quot;: &quot;fa5f9ba8-a1fc-4380-9edb-d0c23eaa24ec&quot;,
      &quot;name&quot;: &quot;control-channel&quot;,
      &quot;metadata&quot;: {
        &quot;type&quot;: &quot;control&quot;
      }
    },
    {
      &quot;id&quot;: &quot;24e5473e-3cbe-43d9-8a8b-a725ff918c0e&quot;,
      &quot;name&quot;: &quot;data-channel&quot;,
      &quot;metadata&quot;: {
        &quot;type&quot;: &quot;data&quot;
      }
    },
    {
      &quot;id&quot;: &quot;1eac45c2-0f72-4089-b255-ebd2e5732bbb&quot;,
      &quot;name&quot;: &quot;export-channel&quot;,
      &quot;metadata&quot;: {
        &quot;type&quot;: &quot;export&quot;
      }
    }
  ],
  &quot;content&quot;: &quot;{\&quot;agent\&quot;:{\&quot;edgex\&quot;:{\&quot;url\&quot;:\&quot;http://localhost:48090/api/v1/\&quot;},\&quot;heartbeat\&quot;:{\&quot;interval\&quot;:\&quot;30s\&quot;},\&quot;log\&quot;:{\&quot;level\&quot;:\&quot;debug\&quot;},\&quot;mqtt\&quot;:{\&quot;mtls\&quot;:false,\&quot;qos\&quot;:0,\&quot;retain\&quot;:false,\&quot;skip_tls_ver\&quot;:true,\&quot;url\&quot;:\&quot;tcp://mainflux-domain.com:1883\&quot;},\&quot;server\&quot;:{\&quot;nats_url\&quot;:\&quot;localhost:4222\&quot;,\&quot;port\&quot;:\&quot;9000\&quot;},\&quot;terminal\&quot;:{\&quot;session_timeout\&quot;:\&quot;30s\&quot;}},\&quot;export\&quot;:{\&quot;exp\&quot;:{\&quot;cache_db\&quot;:\&quot;0\&quot;,\&quot;cache_pass\&quot;:\&quot;\&quot;,\&quot;cache_url\&quot;:\&quot;localhost:6379\&quot;,\&quot;log_level\&quot;:\&quot;debug\&quot;,\&quot;nats\&quot;:\&quot;nats://localhost:4222\&quot;,\&quot;port\&quot;:\&quot;8172\&quot;},\&quot;mqtt\&quot;:{\&quot;ca_path\&quot;:\&quot;ca.crt\&quot;,\&quot;cert_path\&quot;:\&quot;thing.crt\&quot;,\&quot;channel\&quot;:\&quot;\&quot;,\&quot;host\&quot;:\&quot;tcp://mainflux-domain.com:1883\&quot;,\&quot;mtls\&quot;:false,\&quot;password\&quot;:\&quot;\&quot;,\&quot;priv_key_path\&quot;:\&quot;thing.key\&quot;,\&quot;qos\&quot;:0,\&quot;retain\&quot;:false,\&quot;skip_tls_ver\&quot;:false,\&quot;username\&quot;:\&quot;\&quot;},\&quot;routes\&quot;:[{\&quot;mqtt_topic\&quot;:\&quot;\&quot;,\&quot;nats_topic\&quot;:\&quot;channels\&quot;,\&quot;subtopic\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;mfx\&quot;,\&quot;workers\&quot;:10},{\&quot;mqtt_topic\&quot;:\&quot;\&quot;,\&quot;nats_topic\&quot;:\&quot;export\&quot;,\&quot;subtopic\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;default\&quot;,\&quot;workers\&quot;:10}]}}&quot;
}
</code></pre>
<ul>
<li><code>external_id</code> is usually MAC address, but anything that suits applications requirements can be used</li>
<li><code>external_key</code> is key that will be provided to agent process</li>
<li><code>thing_id</code> is mainflux thing id</li>
<li><code>channels</code> is 2-element array where first channel is CONTROL and second is DATA, both channels should be assigned to thing</li>
<li><code>content</code> is used for configuring parameters of agent and export service.</li>
</ul>
<p>Then to start the agent service you can do it like this</p>
<pre><code>git clone https://github.com/MainfluxLabs/agent
make
cd build

MF_AGENT_LOG_LEVEL=debug \
MF_AGENT_BOOTSTRAP_KEY=edged \
MF_AGENT_BOOTSTRAP_ID=34:e1:2d:e6:cf:03 ./mainflux-agent

{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Requesting config for 34:e1:2d:e6:cf:03 from http://localhost:8202/things/bootstrap&quot;,&quot;ts&quot;:&quot;2019-12-05T04:47:24.98411512Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Getting config for 34:e1:2d:e6:cf:03 from http://localhost:8202/things/bootstrap succeeded&quot;,&quot;ts&quot;:&quot;2019-12-05T04:47:24.995465239Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Connected to MQTT broker&quot;,&quot;ts&quot;:&quot;2019-12-05T04:47:25.009645082Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Agent service started, exposed port 9000&quot;,&quot;ts&quot;:&quot;2019-12-05T04:47:25.009755345Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Subscribed to MQTT broker&quot;,&quot;ts&quot;:&quot;2019-12-05T04:47:25.012930443Z&quot;}
</code></pre>
<ul>
<li><code>MF_AGENT_BOOTSTRAP_KEY</code> - is <code>external_key</code> in bootstrap configuration.</li>
<li><code>MF_AGENT_BOOSTRAP_ID</code> - is <code>external_id</code> in bootstrap configuration.</li>
</ul>
<h4 id="remote-execution-of-commands-via-agent">Remote execution of commands via Agent<a class="headerlink" href="#remote-execution-of-commands-via-agent" title="Permanent link">#</a></h4>
<pre><code class="language-bash"># Set connection parameters as environment variables in shell
CH=`curl -s -S -X GET http://some-domain-name:8202/things/bootstrap/34:e1:2d:e6:cf:03 -H &quot;Authorization: edged&quot; -H 'Content-Type: application/json' | jq -r '.mainflux_channels[0].id'`
TH=`curl -s  -S -X GET http://some-domain-name:8202/things/bootstrap/34:e1:2d:e6:cf:03 -H &quot;Authorization: edged&quot; -H 'Content-Type: application/json' | jq -r .mainflux_id`
KEY=`curl -s  -S -X GET http://some-domain-name:8202/things/bootstrap/34:e1:2d:e6:cf:03 -H &quot;Authorization: edged&quot; -H 'Content-Type: application/json' | jq -r .mainflux_key`

# Subscribe for response
mosquitto_sub -d -u $TH -P $KEY  -t channels/$CH/messages/res/# -h some-domain-name -p 1883

# Publish command e.g `ls`
mosquitto_pub -d -u $TH -P $KEY  -t channels/$CH/messages/req -h some-domain-name -p 1883  -m '[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;exec&quot;, &quot;vs&quot;:&quot;ls, -l&quot;}]'
</code></pre>
<h4 id="remote-terminal">Remote terminal<a class="headerlink" href="#remote-terminal" title="Permanent link">#</a></h4>
<p>This can be checked from the UI, click on the details for gateway and below the gateway parameters you will se box with prompt, if <code>agent</code> is running and it is properly connected you should be able to execute commands remotely.</p>
<h4 id="heartbeat">Heartbeat<a class="headerlink" href="#heartbeat" title="Permanent link">#</a></h4>
<p>If there are services that are running on same gateway as <code>agent</code> and they are publishing heartbeat to NATS subject <code>heartbeat.service_name.service</code>
You can get the list of services by sending following mqtt message</p>
<pre><code># View services that are sending heartbeat
mosquitto_pub -d -u $TH -P $KEY  -t channels/$CH/messages/req -h some-domain-name -p 1883  -m '[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;service&quot;, &quot;vs&quot;:&quot;view&quot;}]'
</code></pre>
<p>Response can be observed on <code>channels/$CH/messages/res/#</code></p>
<h3 id="proxying-commands">Proxying commands<a class="headerlink" href="#proxying-commands" title="Permanent link">#</a></h3>
<p>You can send commands to services running on the same edge gateway as Agent if they are subscribed on same NATS server and correct subject.</p>
<p>Service commands are being sent via MQTT to topic:</p>
<p><code>channels/&lt;control_channel_id&gt;/messages/services/&lt;service_name&gt;/&lt;subtopic&gt;</code></p>
<p>when messages is received Agent forwards them to NATS on subject:</p>
<p><code>commands.&lt;service_name&gt;.&lt;subtopic&gt;</code></p>
<p>Payload is up to the application and service itself.</p>
<h3 id="edgex">EdgeX<a class="headerlink" href="#edgex" title="Permanent link">#</a></h3>
<p><a href="https://github.com/edgexfoundry/edgex-go">Edgex</a> control messages are sent and received over control channel. MF sends a control SenML of the following form:</p>
<pre><code>[{&quot;bn&quot;:&quot;&lt;uuid&gt;:&quot;, &quot;n&quot;:&quot;control&quot;, &quot;vs&quot;:&quot;&lt;cmd&gt;, &lt;param&gt;, edgexsvc1, edgexsvc2, …, edgexsvcN&quot;}}]
</code></pre>
<p>For example,</p>
<pre><code>[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;control&quot;, &quot;vs&quot;:&quot;operation, stop, edgex-support-notifications, edgex-core-data&quot;}]
</code></pre>
<p>Agent, on the other hand, returns a response SenML of the following form:</p>
<pre><code>[{&quot;bn&quot;:&quot;&lt;uuid&gt;:&quot;, &quot;n&quot;:&quot;&lt;&gt;&quot;, &quot;v&quot;:&quot;&lt;RESP&gt;&quot;}]
</code></pre>
<h3 id="remote-commands">Remote Commands<a class="headerlink" href="#remote-commands" title="Permanent link">#</a></h3>
<p>EdgeX defines SMA commands in the following <a href="https://github.com/edgexfoundry/edgex-go/blob/master/api/raml/system-agent.raml">RAML file</a></p>
<p>Commands are:</p>
<ul>
<li>OPERATION</li>
<li>CONFIG</li>
<li>METRICS</li>
<li>PING</li>
</ul>
<p><strong>Operation</strong></p>
<pre><code>mosquitto_pub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;channel_id&gt;/messages/req -h localhost -m '[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;control&quot;, &quot;vs&quot;:&quot;edgex-operation, start, edgex-support-notifications, edgex-core-data&quot;}]'
</code></pre>
<p><strong>Config</strong></p>
<pre><code>mosquitto_pub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;channel_id&gt;/messages/req -h localhost -m '[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;control&quot;, &quot;vs&quot;:&quot;edgex-config, edgex-support-notifications, edgex-core-data&quot;}]'
</code></pre>
<p><strong>Metrics</strong></p>
<pre><code>mosquitto_pub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;channel_id&gt;/messages/req -h localhost -m '[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;control&quot;, &quot;vs&quot;:&quot;edgex-metrics, edgex-support-notifications, edgex-core-data&quot;}]'
</code></pre>
<p>If you subscribe to</p>
<pre><code>mosquitto_sub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;channel_id&gt;/messages/#
</code></pre>
<p>You can observe commands and response from commands executed against edgex</p>
<pre><code>[{&quot;bn&quot;:&quot;1:&quot;, &quot;n&quot;:&quot;control&quot;, &quot;vs&quot;:&quot;edgex-metrics, edgex-support-notifications, edgex-core-data&quot;}]                                                                            
[{&quot;bn&quot;:&quot;1&quot;,&quot;n&quot;:&quot;edgex-metrics&quot;,&quot;vs&quot;:&quot;{\&quot;Metrics\&quot;:{\&quot;edgex-core-data\&quot;:{\&quot;CpuBusyAvg\&quot;:15.568632467698606,\&quot;Memory\&quot;:{\&quot;Alloc\&quot;:2040136,\&quot;Frees\&quot;:876344,\&quot;LiveObjects\&quot;:15134,\&quot;Mallocs\&quot;:891478,\&quot;Sys\&quot;:73332984,\&quot;TotalAlloc\&quot;:80657464}},\&quot;edgex-support-notifications\&quot;:{\&quot;CpuBusyAvg\&quot;:14.65381169745318,\&quot;Memory\&quot;:{\&quot;Alloc\&quot;:961784,\&quot;Frees\&quot;:127430,\&quot;LiveObjects\&quot;:6095,\&quot;Mallocs\&quot;:133525,\&quot;Sys\&quot;:72808696,\&quot;TotalAlloc\&quot;:11665416}}}}\n&quot;}]
</code></pre>
<h2 id="export">Export<a class="headerlink" href="#export" title="Permanent link">#</a></h2>
<p>Mainflux Export service can send message from one Mainflux cloud to another via MQTT, or it can send messages from edge gateway to Mainflux Cloud.
Export service is subscribed to local message bus and connected to MQTT broker in the cloud.<br />
Messages collected on local message bus are redirected to the cloud.
When connection is lost, if QoS2 is used, messages from the local bus are stored into file or in memory to be resent upon reconnection.
Additonaly <code>Export</code> service publishes liveliness status to <code>Agent</code> via NATS subject <code>heartbeat.export.service</code></p>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">#</a></h3>
<p>Get the code:</p>
<pre><code class="language-bash">go get github.com/MainfluxLabs/export
cd $GOPATH/github.com/MainfluxLabs/export
</code></pre>
<p>Make:</p>
<pre><code class="language-bash">make
</code></pre>
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">#</a></h3>
<pre><code class="language-bash">cd build
./mainflux-export
</code></pre>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">#</a></h3>
<p>By default <code>Export</code> service looks for config file at <a href="(https://github.com/MainfluxLabs/export/blob/master/configs/config.toml)"><code>../configs/config.toml</code></a> if no env vars are specified.  </p>
<pre><code class="language-toml">[exp]
  log_level = &quot;debug&quot;
  nats = &quot;localhost:4222&quot;
  port = &quot;8170&quot;

[mqtt]
  username = &quot;&lt;thing_id&gt;&quot;
  password = &quot;&lt;thing_password&gt;&quot;
  ca_path = &quot;ca.crt&quot;
  client_cert = &quot;&quot;
  client_cert_key = &quot;&quot;
  client_cert_path = &quot;thing.crt&quot;
  client_priv_key_path = &quot;thing.key&quot;
  mtls = &quot;false&quot;
  priv_key = &quot;thing.key&quot;
  retain = &quot;false&quot;
  skip_tls_ver = &quot;false&quot;
  url = &quot;tcp://mainflux.com:1883&quot;

[[routes]]
  mqtt_topic = &quot;channel/&lt;channel_id&gt;/messages&quot;
  subtopic = &quot;subtopic&quot;
  nats_topic = &quot;export&quot;
  type = &quot;default&quot;
  workers = 10

[[routes]]
  mqtt_topic = &quot;channel/&lt;channel_id&gt;/messages&quot;
  subtopic = &quot;subtopic&quot;
  nats_topic = &quot;channels&quot;
  type = &quot;mfx&quot;
  workers = 10
</code></pre>
<h3 id="environment-variables">Environment variables<a class="headerlink" href="#environment-variables" title="Permanent link">#</a></h3>
<p>Service will first look for <code>MF_EXPORT_CONFIG_FILE</code> for configuration and if not found it will be configured with env variables and new config file specified with <code>MF_EXPORT_CONFIG_FILE</code> (default value will be used if none specified) will be saved with values populated from env vars.<br />
The service is configured using the <a href="env">environment variables</a> as presented in the table. Note that any unset variables will be replaced with their default values.</p>
<p>For values in environment variables to take effect make sure that there is no <code>MF_EXPORT_CONFIG_FILE</code> file.</p>
<p>If you run with environment variables you can create config file:</p>
<pre><code class="language-bash">MF_EXPORT_PORT=8178 \
MF_EXPORT_LOG_LEVEL=debug \
MF_EXPORT_MQTT_HOST=tcp://localhost:1883 \
MF_EXPORT_MQTT_USERNAME=&lt;thing_id&gt; \
MF_EXPORT_MQTT_PASSWORD=&lt;thing_key&gt; \
MF_EXPORT_MQTT_CHANNEL=&lt;channel_id&gt; \
MF_EXPORT_MQTT_SKIP_TLS=true \
MF_EXPORT_MQTT_MTLS=false \
MF_EXPORT_MQTT_CA=ca.crt \
MF_EXPORT_MQTT_CLIENT_CERT=thing.crt \
MF_EXPORT_MQTT_CLIENT_PK=thing.key \
MF_EXPORT_CONFIG_FILE=export.toml \
../build/mainflux-export&amp;
</code></pre>
<p>Values from environment variables will be used to populate export.toml</p>
<h4 id="http-port">Http port<a class="headerlink" href="#http-port" title="Permanent link">#</a></h4>
<ul>
<li><code>port</code> - HTTP port where status of <code>Export</code> service can be fetched.</li>
</ul>
<pre><code class="language-bash">curl -X GET http://localhost:8170/health
'{&quot;status&quot;: &quot;pass&quot;, &quot;version&quot;:&quot;0.12.1&quot;, &quot;commit&quot;:&quot;57cca9677721025da055c47957fc3e869e0325aa&quot; , &quot;description&quot;:&quot;export service&quot;, &quot;build_time&quot;: &quot;2022-01-19_10:13:17&quot;}'
</code></pre>
<h4 id="mqtt-connection">MQTT connection<a class="headerlink" href="#mqtt-connection" title="Permanent link">#</a></h4>
<p>To establish connection to MQTT broker following settings are needed:
- <code>username</code> - Mainflux <thing_id>
- <code>password</code> - Mainflux <thing_key>
- <code>url</code> - url of MQTT broker</p>
<p>Additionally, you will need MQTT client certificates if you enable mTLS. To obtain certificates <code>ca.crt</code>, <code>thing.crt</code> and key <code>thing.key</code> follow instructions <a href="https://mainflux.readthedocs.io/en/latest/authentication/#mutual-tls-authentication-with-x509-certificates">here</a> or <a href="/provision/#certs-service">here</a>.</p>
<h4 id="mtls">MTLS<a class="headerlink" href="#mtls" title="Permanent link">#</a></h4>
<p>To setup <code>MTLS</code> connection <code>Export</code> service requires client certificate and <code>mtls</code> in config or <code>MF_EXPORT_MQTT_MTLS</code> must be set to <code>true</code>.
Client certificate can be provided in a file, <code>client_cert_path</code> and <code>client_cert_key_path</code> are used for specifying path to certificate files.
If MTLS is used and no certificate file paths are specified then <code>Export</code> will look in <code>client_cert</code> and <code>client_cert_key</code> of config file expecting certificate content stored as string.</p>
<h4 id="routes">Routes<a class="headerlink" href="#routes" title="Permanent link">#</a></h4>
<p>Routes are being used for specifying which subscriber's topic(subject) goes to which publishing topic.
Currently only MQTT is supported for publishing.
To match Mainflux requirements <code>mqtt_topic</code> must contain <code>channel/&lt;channel_id&gt;/messages</code>, additional subtopics can be appended.</p>
<ul>
<li><code>mqtt_topic</code> - <code>channel/&lt;channel_id&gt;/messages/&lt;custom_subtopic&gt;</code></li>
<li><code>nats_topic</code> - <code>Export</code> service will be subscribed to NATS subject <code>&lt;nats_topic&gt;.&gt;</code></li>
<li><code>subtopic</code> - messages will be published to MQTT topic <code>&lt;mqtt_topic&gt;/&lt;subtopic&gt;/&lt;nats_subject&gt;</code>, where dots in nats_subject are replaced with '/'</li>
<li><code>workers</code> - specifies number of workers that will be used for message forwarding.</li>
<li><code>type</code> - specifies message transformation:<ul>
<li><code>default</code> is for sending messages as they are received on NATS with no transformation (so they should be in SenML or JSON format if we want to persist them in Mainflux in cloud). If you don't want to persist messages in Mainflux or you are not exporting to Mainflux cloud - message format can be anything that suits your application as message passes untransformed.</li>
<li><code>mfx</code> is for messages that are being picked up on internal Mainflux NATS bus. When using <code>Export</code> along with Mainflux deployed on gateway (<a href="#edge">Fig. 1</a>) messages coming from MQTT broker that are published to NATS bus are <a href="(https://github.com/MainfluxLabs/mainflux/blob/master/pkg/messaging/message.proto)">Mainflux message</a>. Using <code>mfx</code> type will extract payload and <code>export</code> will publish it to <code>mqtt_topic</code>. Extracted payload is SenML or JSON if we want to persist messages. <code>nats_topic</code> in this case must be <code>channels</code>, or if you want to pick messages from a specific channel in local Mainflux instance to be exported to cloud you can put <code>channels.&lt;local_mainflux_channel_id&gt;</code>.</li>
</ul>
</li>
</ul>
<p>Before running <code>Export</code> service edit <code>configs/config.toml</code> and provide <code>username</code>, <code>password</code> and <code>url</code>
 * <code>username</code> - matches <code>thing_id</code> in Mainflux cloud instance
 * <code>password</code> - matches <code>thing_key</code>
 * <code>channel</code> - MQTT part of the topic where to publish MQTT data (<code>channel/&lt;channel_id&gt;/messages</code> is format of mainflux MQTT topic) and plays a part in authorization.</p>
<p>If Mainflux and Export service are deployed on same gateway <code>Export</code> can be configured to send messages from Mainflux internal NATS bus to Mainflux in a cloud.
In order for <code>Export</code> service to listen on Mainflux NATS deployed on the same machine NATS port must be exposed.
Edit Mainflux <a href="(https://github.com/MainfluxLabs/mainflux/docker/docker-compose.yml)">docker-compose.yml</a>. NATS section must look like below:</p>
<pre><code>  nats:
    image: nats:1.3.0
    container_name: mainflux-nats
    restart: on-failure
    networks:
      - mainflux-base-net
    ports:
      - 4222:4222
</code></pre>
<h3 id="how-to-save-config-via-agent">How to save config via agent<a class="headerlink" href="#how-to-save-config-via-agent" title="Permanent link">#</a></h3>
<p>Configuration file for <code>Export</code> service can be sent over MQTT using <a href="(https://github.com/MainfluxLabs/agent)">Agent</a> service.</p>
<pre><code>mosquitto_pub -u &lt;thing_id&gt; -P &lt;thing_key&gt; -t channels/&lt;control_ch_id&gt;/messages/req -h localhost -p 18831  -m  &quot;[{\&quot;bn\&quot;:\&quot;1:\&quot;, \&quot;n\&quot;:\&quot;config\&quot;, \&quot;vs\&quot;:\&quot;save, export, &lt;config_file_path&gt;, &lt;file_content_base64&gt;\&quot;}]&quot;
</code></pre>
<p><code>vs="save, export, config_file_path, file_content_base64"</code> - vs determines where to save file and contains file content in base64 encoding payload:</p>
<pre><code>b,_ := toml.Marshal(export.Config)
payload := base64.StdEncoding.EncodeToString(b)
</code></pre>
<h3 id="using-configure-script">Using configure script<a class="headerlink" href="#using-configure-script" title="Permanent link">#</a></h3>
<p>There is a <code>configuration.sh</code> script in a <code>scripts</code> directory that can be used for automatic configuration and start up of remotely deployed <code>export</code>. For this to work it is presumed that <code>mainflux-export</code> and <code>scripts/export_start</code> are placed in executable path on remote device. Additionally this script requires that remote device is provisioned following the steps described for <a href="provision.md">provision</a> service.</p>
<p>To run it first edit script to set parameters</p>
<pre><code>MTLS=false
EXTERNAL_KEY='raspberry'
EXTERNAL_ID='pi'
MAINFLUX_HOST='mainflux.com'
MAINFLUX_USER_EMAIL='edge@email.com'
MAINFLUX_USER_PASSWORD='12345678'
</code></pre>
<p><code>EXTERNAL_KEY</code> and <code>EXTERNAL_ID</code> are parameters posted to <code>/mapping</code> endpoint of <code>provision</code> service, <code>MAINFLUX_HOST</code> is location of cloud instance of Mainflux that <code>export</code> should connect to and <code>MAINFLUX_USER_EMAIL</code> and <code>MAINFLUX_USER_PASSWORD</code> are users credentials in the cloud.</p>
<h2 id="example-deployment">Example deployment<a class="headerlink" href="#example-deployment" title="Permanent link">#</a></h2>
<h3 id="edge-deployment">Edge deployment<a class="headerlink" href="#edge-deployment" title="Permanent link">#</a></h3>
<p>The following are steps that are an example usage of Mainflux components to connect edge with cloud.
We will start Mainflux in the cloud with additional services <a href="bootstrap">Bootstrap</a> and <a href="provision">Provision</a>.
Using <a href="bootstrap">Bootstrap</a> and <a href="provision">Provision</a> we will create a configuration for use in gateway deployment.
On the gateway we will start services <a href="/edge/#agent">Agent</a> and <a href="/edge/#export">Export</a> using previously created configuration.</p>
<h2 id="services-in-the-cloud">Services in the cloud<a class="headerlink" href="#services-in-the-cloud" title="Permanent link">#</a></h2>
<p>Start the Mainflux:</p>
<pre><code class="language-bash">docker-compose -f docker/docker-compose.yml up
</code></pre>
<p>Create user:</p>
<pre><code class="language-bash">mainflux-cli -m http://localhost:8180 users create test@email.com 12345678
</code></pre>
<p>Obtain user token:</p>
<pre><code class="language-bash">mainflux-cli -m http://localhost:8180 users token test@email.com 12345678

created: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODk5MDQ4MDQsImlhdCI6MTU4OTg2ODgwNCwiaXNzIjoibWFpbmZsdXguYXV0aG4iLCJzdWIiOiJ0ZXN0QGVtYWlsLmNvbSIsInR5cGUiOjB9.VSwpGoflOLqrHlCGoVVFPBdnnvsAhv2gc3EomXg9yM0

TOK=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODk5MDQ4MDQsImlhdCI6MTU4OTg2ODgwNCwiaXNzIjoibWFpbmZsdXguYXV0aG4iLCJzdWIiOiJ0ZXN0QGVtYWlsLmNvbSIsInR5cGUiOjB9.VSwpGoflOLqrHlCGoVVFPBdnnvsAhv2gc3EomXg9yM0
</code></pre>
<p>Provision a gateway:</p>
<pre><code class="language-bash">curl -s -S  -X POST  http://localhost:8190/mapping -H &quot;Authorization: Bearer $TOKEN&quot; -H 'Content-Type: application/json'   -d '{&quot;name&quot;:&quot;testing&quot;,  &quot;external_id&quot; : &quot;54:FG:66:DC:43&quot;, &quot;external_key&quot;:&quot;223334fw2&quot; }' | jq
</code></pre>
<pre><code class="language-json">{
  &quot;things&quot;: [
    {
      &quot;id&quot;: &quot;88529fb2-6c1e-4b60-b9ab-73b5d89f7404&quot;,
      &quot;name&quot;: &quot;thing&quot;,
      &quot;key&quot;: &quot;3529c1bb-7211-4d40-9cd8-b05833196093&quot;,
      &quot;metadata&quot;: {
        &quot;external_id&quot;: &quot;54:FG:66:DC:43&quot;
      }
    }
  ],
  &quot;channels&quot;: [
    {
      &quot;id&quot;: &quot;1aa3f736-0bd3-44b5-a917-a72cc743f633&quot;,
      &quot;name&quot;: &quot;control-channel&quot;,
      &quot;metadata&quot;: {
        &quot;type&quot;: &quot;control&quot;
      }
    },
    {
      &quot;id&quot;: &quot;e2adcfa6-96b2-425d-8cd4-ff8cb9c056ce&quot;,
      &quot;name&quot;: &quot;data-channel&quot;,
      &quot;metadata&quot;: {
        &quot;type&quot;: &quot;data&quot;
      }
    }
  ],
  &quot;whitelisted&quot;: {
    &quot;88529fb2-6c1e-4b60-b9ab-73b5d89f7404&quot;: true
  }
}
</code></pre>
<p>Parameters <external_id> and <external_key> are representing the gateway. <code>Provision</code> will use them to create a bootstrap configuration that will make a relation with Mainflux entities used for connection, authentication and authorization <code>thing</code> and <code>channel</code>.
These parameters will be used by <code>Agent</code> service on the gateway to retrieve that information and establish a connection with the cloud.</p>
<h2 id="services-on-the-edge">Services on the Edge<a class="headerlink" href="#services-on-the-edge" title="Permanent link">#</a></h2>
<h3 id="agent_1">Agent<a class="headerlink" href="#agent_1" title="Permanent link">#</a></h3>
<p>Start the [NATS][nats] and <a href="(https://github.com/MainfluxLabs/agent)">Agent</a> service:</p>
<pre><code class="language-bash">gnatsd
MF_AGENT_BOOTSTRAP_ID=54:FG:66:DC:43 \
MF_AGENT_BOOTSTRAP_KEY=&quot;223334fw2&quot; \
MF_AGENT_BOOTSTRAP_URL=http://localhost:8202/things/bootstrap \
build/mainflux-agent
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Requesting config for 54:FG:66:DC:43 from http://localhost:8202/things/bootstrap&quot;,&quot;ts&quot;:&quot;2020-05-07T15:50:58.041145096Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Getting config for 54:FG:66:DC:43 from http://localhost:8202/things/bootstrap succeeded&quot;,&quot;ts&quot;:&quot;2020-05-07T15:50:58.120779415Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Saving export config file /configs/export/config.toml&quot;,&quot;ts&quot;:&quot;2020-05-07T15:50:58.121602229Z&quot;}
{&quot;level&quot;:&quot;warn&quot;,&quot;message&quot;:&quot;Failed to save export config file Error writing config file: open /configs/export/config.toml: no such file or directory&quot;,&quot;ts&quot;:&quot;2020-05-07T15:50:58.121752142Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Client agent-88529fb2-6c1e-4b60-b9ab-73b5d89f7404 connected&quot;,&quot;ts&quot;:&quot;2020-05-07T15:50:58.128500603Z&quot;}
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Agent service started, exposed port 9003&quot;,&quot;ts&quot;:&quot;2020-05-07T15:50:58.128531057Z&quot;}
</code></pre>
<h3 id="export_1">Export<a class="headerlink" href="#export_1" title="Permanent link">#</a></h3>
<pre><code>git clone https://github.com/MainfluxLabs/export
make
</code></pre>
<p>Edit the <code>configs/config.toml</code> setting
- <code>username</code> - thing from the results of provision request.
- <code>password</code> - key from the results of provision request.
- <code>mqtt_topic</code> - in routes set to <code>channels/&lt;channel_data_id&gt;/messages</code> from results of provision.
- <code>nats_topic</code> - whatever you need, export will subscribe to <code>export.&lt;nats_topic&gt;</code> and forward messages to MQTT.
- <code>host</code> - url of MQTT broker.</p>
<pre><code class="language-toml">[exp]
  cache_pass = &quot;&quot;
  cache_url = &quot;&quot;
  log_level = &quot;debug&quot;
  nats = &quot;localhost:4222&quot;
  port = &quot;8170&quot;

[mqtt]
  ca_path = &quot;&quot;
  cert_path = &quot;&quot;
  host = &quot;tcp://localhost:1883&quot;
  mtls = false
  password = &quot;3529c1bb-7211-4d40-9cd8-b05833196093&quot;
  priv_key_path = &quot;&quot;
  qos = 0
  retain = false
  skip_tls_ver = false
  username = &quot;88529fb2-6c1e-4b60-b9ab-73b5d89f7404&quot;

[[routes]]
  mqtt_topic = &quot;channels/e2adcfa6-96b2-425d-8cd4-ff8cb9c056ce/messages&quot;
  nats_topic = &quot;&gt;&quot;
  workers = 10
</code></pre>
<pre><code class="language-bash">cd build
./mainflux-export
2020/05/07 17:36:57 Configuration loaded from file ../configs/config.toml
{&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Export service started, exposed port :8170&quot;,&quot;ts&quot;:&quot;2020-05-07T15:36:57.528398548Z&quot;}
{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;Client export-88529fb2-6c1e-4b60-b9ab-73b5d89f7404 connected&quot;,&quot;ts&quot;:&quot;2020-05-07T15:36:57.528405818Z&quot;}
</code></pre>
<h4 id="testing-export">Testing Export<a class="headerlink" href="#testing-export" title="Permanent link">#</a></h4>
<pre><code class="language-bash">git clone https://github.com/nats-io/nats.go
cd github.com/nats-io/nats.go/examples/nats-pub
go run main.go -s http://localhost:4222 export.test &quot;[{\&quot;bn\&quot;:\&quot;test\&quot;}]&quot;;
</code></pre>
<p>We have configured route for export, <code>nats_topic = "&gt;"</code> means that it will listen to <code>NATS</code> subject <code>export.&gt;</code> and <code>mqtt_topic</code> is configured so that data will be sent to MQTT broker on topic <code>channels/e2adcfa6-96b2-425d-8cd4-ff8cb9c056ce/messages</code> with appended <code>NATS</code> subject.</p>
<p>In terminal where export is started you should see following message:</p>
<pre><code class="language-log">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;Published to: export.test, payload: [{\&quot;bn\&quot;:\&quot;test\&quot;}]&quot;,&quot;ts&quot;:&quot;2020-05-08T15:14:15.757298992Z&quot;}
</code></pre>
<p>In Mainflux <code>mqtt</code> service:</p>
<pre><code class="language-log">mainflux-mqtt   | {&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Publish - client ID export-88529fb2-6c1e-4b60-b9ab-73b5d89f7404 to the topic: channels/e2adcfa6-96b2-425d-8cd4-ff8cb9c056ce/messages/export/test&quot;,&quot;ts&quot;:&quot;2020-05-08T15:16:02.999684791Z&quot;}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../storage/" class="btn btn-neutral float-left" title="Storage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../security/" class="btn btn-neutral float-right" title="Security">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright (c) MainfluxLabs</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/MainfluxLabs/docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../storage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../security/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
