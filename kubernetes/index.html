
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Mainflux IoT System">
      
      
      
        <link rel="canonical" href="https://docs.mainflux.io/kubernetes/">
      
      <link rel="icon" href="../img/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.1">
    
    
      
        <title>Kubernetes - Mainflux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e8d9bf0c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubernetes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mainflux" class="md-header__button md-logo" aria-label="Mainflux" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mainflux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kubernetes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mainflux/mainflux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mainflux" class="md-nav__button md-logo" aria-label="Mainflux" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    Mainflux
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mainflux/mainflux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../provision/" class="md-nav__link">
        Provision
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../messaging/" class="md-nav__link">
        Messaging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lora/" class="md-nav__link">
        LoRa
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../opcua/" class="md-nav__link">
        OPC-UA
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../edge/" class="md-nav__link">
        Edge
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../groups/" class="md-nav__link">
        Groups
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bootstrap/" class="md-nav__link">
        Bootstrap
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../twins/" class="md-nav__link">
        Twins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tracing/" class="md-nav__link">
        Tracing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dev-guide/" class="md-nav__link">
        Developer's Guide
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Kubernetes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes_1" class="md-nav__link">
    Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    Kubectl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-v3" class="md-nav__link">
    Helm v3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stable-helm-repository" class="md-nav__link">
    Stable Helm Repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-ingress-controller" class="md-nav__link">
    Nginx Ingress Controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-mainflux" class="md-nav__link">
    Deploying Mainflux
  </a>
  
    <nav class="md-nav" aria-label="Deploying Mainflux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizing-installation" class="md-nav__link">
    Customizing Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-steps-to-configure-ingress-controller" class="md-nav__link">
    Additional Steps to Configure Ingress Controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-mtls" class="md-nav__link">
    TLS &amp; mTLS
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/" class="md-nav__link">
        Benchmark
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes_1" class="md-nav__link">
    Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    Kubectl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helm-v3" class="md-nav__link">
    Helm v3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stable-helm-repository" class="md-nav__link">
    Stable Helm Repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-ingress-controller" class="md-nav__link">
    Nginx Ingress Controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-mainflux" class="md-nav__link">
    Deploying Mainflux
  </a>
  
    <nav class="md-nav" aria-label="Deploying Mainflux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizing-installation" class="md-nav__link">
    Customizing Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-steps-to-configure-ingress-controller" class="md-nav__link">
    Additional Steps to Configure Ingress Controller
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-mtls" class="md-nav__link">
    TLS &amp; mTLS
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="kubernetes">Kubernetes<a class="headerlink" href="#kubernetes" title="Permanent link">#</a></h1>
<p>Mainflux can be easily deployed on Kubernetes platform by using Helm Chart from official <a href="https://github.com/mainflux/devops">Mainflux DevOps GitHub repository</a>.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h2>
<ul>
<li>Kubernetes</li>
<li>kubectl</li>
<li>Helm v3</li>
<li>Stable Helm repository</li>
<li>Nginx Ingress Controller</li>
</ul>
<h3 id="kubernetes_1">Kubernetes<a class="headerlink" href="#kubernetes_1" title="Permanent link">#</a></h3>
<p>Kubernetes is an open source container orchestration engine for automating deployment, scaling, and management of containerised applications.
Install it locally or have access to a cluster. Follow <a href="https://kubernetes.io/docs/setup/">these instructions</a> if you need more information.</p>
<h3 id="kubectl">Kubectl<a class="headerlink" href="#kubectl" title="Permanent link">#</a></h3>
<p>Kubectl is official Kubernetes command line client. Follow <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">these instructions</a> to install it.</p>
<p>Regarding the cluster control with <code>kubectl</code>, default config <code>.yaml</code> file should be <code>~/.kube/config</code>.</p>
<h3 id="helm-v3">Helm v3<a class="headerlink" href="#helm-v3" title="Permanent link">#</a></h3>
<p>Helm is the package manager for Kubernetes. Follow <a href="https://helm.sh/docs/intro/install/">these instructions</a> to install it.</p>
<h3 id="stable-helm-repository">Stable Helm Repository<a class="headerlink" href="#stable-helm-repository" title="Permanent link">#</a></h3>
<p>Add a stable chart repository:</p>
<pre><code class="language-bash">helm repo add stable https://charts.helm.sh/stable
</code></pre>
<p>Add a bitnami chart repository:</p>
<pre><code class="language-bash">helm repo add bitnami https://charts.bitnami.com/bitnami
</code></pre>
<h3 id="nginx-ingress-controller">Nginx Ingress Controller<a class="headerlink" href="#nginx-ingress-controller" title="Permanent link">#</a></h3>
<p>Follow <a href="https://kubernetes.github.io/ingress-nginx/deploy/">these instructions</a> to install it or:</p>
<pre><code class="language-bash">helm install ingress-nginx ingress-nginx/ingress-nginx --version 3.26.0 --create-namespace -n ingress-nginx
</code></pre>
<h2 id="deploying-mainflux">Deploying Mainflux<a class="headerlink" href="#deploying-mainflux" title="Permanent link">#</a></h2>
<p>Get Helm charts from <a href="https://github.com/mainflux/devops">Mainflux DevOps GitHub repository</a>:</p>
<pre><code class="language-bash">git clone https://github.com/mainflux/devops.git
cd devops/charts/mainflux
</code></pre>
<p>Update the on-disk dependencies to mirror Chart.yaml:</p>
<pre><code class="language-bash">helm dependency update
</code></pre>
<p>If you didn't already have namespace created you should do it with:</p>
<pre><code class="language-bash">kubectl create namespace mf
</code></pre>
<p>Deploying release named <code>mainflux</code> in namespace named <code>mf</code> is done with just:</p>
<pre><code class="language-bash">helm install mainflux . -n mf
</code></pre>
<p>Mainflux is now deployed on your Kubernetes.</p>
<h3 id="customizing-installation">Customizing Installation<a class="headerlink" href="#customizing-installation" title="Permanent link">#</a></h3>
<p>You can override default values while installing with <code>--set</code> option. For example, if you want to specify ingress hostname and pull <code>latest</code> tag of <code>users</code> image:</p>
<pre><code class="language-bash">helm install mainflux -n mf --set ingress.hostname='example.com' --set users.image.tag='latest'
</code></pre>
<p>Or if release is already installed, you can update it:</p>
<pre><code class="language-bash">helm upgrade mainflux -n mf --set ingress.hostname='example.com' --set users.image.tag='latest'
</code></pre>
<p>The following table lists the configurable parameters and their default values.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>defaults.logLevel</td>
<td>Log level</td>
<td>debug</td>
</tr>
<tr>
<td>defaults.image.pullPolicy</td>
<td>Docker Image Pull Policy</td>
<td>IfNotPresent</td>
</tr>
<tr>
<td>defaults.image.repository</td>
<td>Docker Image Repository</td>
<td>mainflux</td>
</tr>
<tr>
<td>defaults.image.tag</td>
<td>Docker Image Tag</td>
<td>0.11.0</td>
</tr>
<tr>
<td>defaults.replicaCount</td>
<td>Replicas of MQTT adapter, Things, Envoy and Authn</td>
<td>3</td>
</tr>
<tr>
<td>defaults.natsPort</td>
<td>NATS port</td>
<td>4222</td>
</tr>
<tr>
<td>defaults.jaegerPort</td>
<td>Jaeger port</td>
<td>6831</td>
</tr>
<tr>
<td>nginxInternal.mtls.tls</td>
<td>TLS secret which contains the server cert/key</td>
<td></td>
</tr>
<tr>
<td>nginxInternal.mtls.intermediateCrt</td>
<td>Generic secret which contains the intermediate cert used to verify clients</td>
<td></td>
</tr>
<tr>
<td>ingress.enabled</td>
<td>Should the Nginx Ingress be created</td>
<td>true</td>
</tr>
<tr>
<td>ingress.hostname</td>
<td>Hostname for the Nginx Ingress</td>
<td></td>
</tr>
<tr>
<td>ingress.tls.hostname</td>
<td>Hostname of the Nginx Ingress certificate</td>
<td></td>
</tr>
<tr>
<td>ingress.tls.secret</td>
<td>TLS secret for the Nginx Ingress</td>
<td></td>
</tr>
<tr>
<td>nats.maxPayload</td>
<td>Maximum payload size in bytes that the NATS server will accept</td>
<td>268435456</td>
</tr>
<tr>
<td>nats.replicaCount</td>
<td>NATS replicas</td>
<td>3</td>
</tr>
<tr>
<td>authn.dbPort</td>
<td>AuthN service DB port</td>
<td>5432</td>
</tr>
<tr>
<td>authn.grpcPort</td>
<td>AuthN service gRPC port</td>
<td>8181</td>
</tr>
<tr>
<td>authn.httpPort</td>
<td>AuthN service HTTP port</td>
<td>8189</td>
</tr>
<tr>
<td>users.dbPort</td>
<td>Users service DB port</td>
<td>5432</td>
</tr>
<tr>
<td>users.httpPort</td>
<td>Users service HTTP port</td>
<td>8180</td>
</tr>
<tr>
<td>things.dbPort</td>
<td>Things service DB port</td>
<td>5432</td>
</tr>
<tr>
<td>things.httpPort</td>
<td>Things service HTTP port</td>
<td>8182</td>
</tr>
<tr>
<td>things.authGrpcPort</td>
<td>Things service Auth gRPC port</td>
<td>8183</td>
</tr>
<tr>
<td>things.authHttpPort</td>
<td>Things service Auth HTTP port</td>
<td>8989</td>
</tr>
<tr>
<td>things.redisESPort</td>
<td>Things service Redis Event Store port</td>
<td>6379</td>
</tr>
<tr>
<td>things.redisCachePort</td>
<td>Things service Redis Auth Cache port</td>
<td>6379</td>
</tr>
<tr>
<td>adapter_http.httpPort</td>
<td>HTTP adapter port</td>
<td>8185</td>
</tr>
<tr>
<td>mqtt.proxy.mqttPort</td>
<td>MQTT adapter proxy port</td>
<td>1884</td>
</tr>
<tr>
<td>mqtt.proxy.wsPort</td>
<td>MQTT adapter proxy WS port</td>
<td>8081</td>
</tr>
<tr>
<td>mqtt.broker.mqttPort</td>
<td>MQTT adapter broker port</td>
<td>1883</td>
</tr>
<tr>
<td>mqtt.broker.wsPort</td>
<td>MQTT adapter broker WS port</td>
<td>8080</td>
</tr>
<tr>
<td>mqtt.broker.persistentVolume.size</td>
<td>MQTT adapter broker data Persistent Volume size</td>
<td>5Gi</td>
</tr>
<tr>
<td>mqtt.redisESPort</td>
<td>MQTT adapter Event Store port</td>
<td>6379</td>
</tr>
<tr>
<td>mqtt.redisCachePort</td>
<td>MQTT adapter Redis Auth Cache port</td>
<td>6379</td>
</tr>
<tr>
<td>adapter_coap.udpPort</td>
<td>CoAP adapter UDP port</td>
<td>5683</td>
</tr>
<tr>
<td>ui.port</td>
<td>UI port</td>
<td>3000</td>
</tr>
<tr>
<td>bootstrap.enabled</td>
<td>Enable bootstrap service</td>
<td>false</td>
</tr>
<tr>
<td>bootstrap.dbPort</td>
<td>Bootstrap service DB port</td>
<td>5432</td>
</tr>
<tr>
<td>bootstrap.httpPort</td>
<td>Bootstrap service HTTP port</td>
<td>8182</td>
</tr>
<tr>
<td>bootstrap.redisESPort</td>
<td>Bootstrap service Redis Event Store port</td>
<td>6379</td>
</tr>
<tr>
<td>influxdb.enabled</td>
<td>Enable InfluxDB reader &amp; writer</td>
<td>false</td>
</tr>
<tr>
<td>influxdb.dbPort</td>
<td>InfluxDB port</td>
<td>8086</td>
</tr>
<tr>
<td>influxdb.writer.httpPort</td>
<td>InfluxDB writer HTTP port</td>
<td>8900</td>
</tr>
<tr>
<td>influxdb.reader.httpPort</td>
<td>InfluxDB reader HTTP port</td>
<td>8905</td>
</tr>
<tr>
<td>adapter_opcua.enabled</td>
<td>Enable OPC-UA adapter</td>
<td>false</td>
</tr>
<tr>
<td>adapter_opcua.httpPort</td>
<td>OPC-UA adapter HTTP port</td>
<td>8188</td>
</tr>
<tr>
<td>adapter_opcua.redisRouteMapPort</td>
<td>OPC-UA adapter Redis Auth Cache port</td>
<td>6379</td>
</tr>
<tr>
<td>adapter_lora.enabled</td>
<td>Enable LoRa adapter</td>
<td>false</td>
</tr>
<tr>
<td>adapter_lora.httpPort</td>
<td>LoRa adapter HTTP port</td>
<td>8187</td>
</tr>
<tr>
<td>adapter_lora.redisRouteMapPort</td>
<td>LoRa adapter Redis Auth Cache port</td>
<td>6379</td>
</tr>
<tr>
<td>twins.enabled</td>
<td>Enable twins service</td>
<td>false</td>
</tr>
<tr>
<td>twins.dbPort</td>
<td>Twins service DB port</td>
<td>27017</td>
</tr>
<tr>
<td>twins.httpPort</td>
<td>Twins service HTTP port</td>
<td>9021</td>
</tr>
<tr>
<td>twins.redisCachePort</td>
<td>Twins service Redis Cache port</td>
<td>6379</td>
</tr>
</tbody>
</table>
<p>All Mainflux services (both core and add-ons) can have their <code>logLevel</code>, <code>image.pullPolicy</code>, <code>image.repository</code> and <code>image.tag</code> overridden.</p>
<p>Mainflux Core is a minimalistic set of required Mainflux services. They are all installed by default:</p>
<ul>
<li>authn</li>
<li>users</li>
<li>things</li>
<li>adapter_http</li>
<li>adapter_mqtt</li>
<li>adapter_coap</li>
<li>ui</li>
</ul>
<p>Mainflux Add-ons are optional services that are disabled by default. Find in Configuration table parameters for enabling them, i.e. to enable influxdb reader &amp; writer you should run <code>helm install</code> with <code>--set influxdb=true</code>.
List of add-ons services in charts:</p>
<ul>
<li>bootstrap</li>
<li>influxdb.writer</li>
<li>influxdb.reader</li>
<li>adapter_opcua</li>
<li>adapter_lora</li>
<li>twins</li>
</ul>
<p>By default scale of MQTT adapter, Things, Envoy, Authn and NATS will be set to 3. It's recommended that you set this values to number of your nodes in Kubernetes cluster, i.e. <code>--set defaults.replicaCount=3 --set nats.replicaCount=3</code></p>
<h3 id="additional-steps-to-configure-ingress-controller">Additional Steps to Configure Ingress Controller<a class="headerlink" href="#additional-steps-to-configure-ingress-controller" title="Permanent link">#</a></h3>
<p>To send MQTT messages to your host on ports <code>1883</code> and <code>8883</code> some additional steps are required in configuring NGINX Ingress Controller.</p>
<p>NGINX Ingress Controller uses ConfigMap to expose TCP services. That ConfigMap is included in helm chart in <a href="https://github.com/mainflux/devops/blob/master/charts/mainflux/templates/ingress.yaml#L141">ingress.yaml</a> file assuming that location of ConfigMap should be <code>ingress-nginx/tcp-services</code>. If Ingress Controller expects it in some other namespace or with other name you should edit metadata in <a href="https://github.com/mainflux/devops/blob/master/charts/mainflux/templates/ingress.yaml#L147">ingress.yaml</a>. This location was set with <code>--tcp-services-configmap</code> flag and you can check it in deployment of Ingress Controller or add it there in <a href="https://kubernetes.github.io/ingress-nginx/user-guide/cli-arguments/">args section for nginx-ingress-controller</a> if it's not already specified. This is explained in <a href="https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/">NGINX Ingress documentation</a></p>
<p>Also, those two ports need to be exposed in the Service defined for the Ingress. You can do that with command that edit your service:</p>
<p><code>kubectl edit svc -n ingress-nginx nginx-ingress-ingress-nginx-controller</code></p>
<p>and add in spec-&gt;ports:</p>
<pre><code>  - name: mqtt
    port: 1883
    protocol: TCP
    targetPort: 1883
  - name: mqtts
    port: 8883
    protocol: TCP
    targetPort: 8883
</code></pre>
<h2 id="tls-mtls">TLS &amp; mTLS<a class="headerlink" href="#tls-mtls" title="Permanent link">#</a></h2>
<p>For testing purposes you can generate certificates as explained in detail in <a href="/authentication">authentication</a> chapter of this document. So, you can use <a href="https://github.com/mainflux/mainflux/blob/master/docker/ssl/Makefile">this script</a> and after replacing all <code>localhost</code> with your hostname, run:</p>
<pre><code>make ca
make server_cert
make thing_cert KEY=&lt;thing_key&gt;
</code></pre>
<p>you should get in <code>certs</code> folder these certificates that we will use for setting up TLS and mTLS:</p>
<pre><code>ca.crt
ca.key
ca.srl
mainflux-server.crt
mainflux-server.key
thing.crt
thing.key
</code></pre>
<p>Create kubernetes secrets using those certificates with running commands from (secrets script)[https://github.com/mainflux/devops/blob/master/charts/mainflux/secrets/secrets.sh]. In this example secrets are created in <code>mf</code> namespace:</p>
<pre><code>kubectl -n mf create secret tls mainflux-server \
    --key mainflux-server.key \
    --cert mainflux-server.crt

kubectl -n mf create secret generic ca \
    --from-file=ca.crt
</code></pre>
<p>You can check if they are succesfully created:
 <code>kubectl get secrets -n mf</code></p>
<p>And now set ingress.hostname, ingress.tls.hostname to your hostname and ingress.tls.secret to <code>mainflux-server</code> and after helm update you have secured ingress with TLS certificate.</p>
<p>For mTLS you need to set <code>nginx_internal.mtls.tls="mainflux-server"</code> and <code>nginx_internal.mtls.intermediate_crt="ca"</code>.</p>
<p>Now you can test sending mqtt message with this parameters:</p>
<pre><code>mosquitto_pub -d -L mqtts://&lt;thing_id&gt;:&lt;thing_key&gt;@example.com:8883/channels/&lt;channel_id&gt;/messages  --cert  thing.crt --key thing.key --cafile ca.crt  -m &quot;test-message&quot;
</code></pre>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../dev-guide/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Developer&#39;s Guide" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Developer's Guide
            </div>
          </div>
        </a>
      
      
        
        <a href="../benchmark/" class="md-footer__link md-footer__link--next" aria-label="Next: Benchmark" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Benchmark
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) Mainflux
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.8aa65030.min.js"></script>
      
    
  </body>
</html>