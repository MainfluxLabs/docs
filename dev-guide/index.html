
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Mainflux IoT System">
      
      
      
        <link rel="canonical" href="https://docs.mainflux.io/dev-guide/">
      
      <link rel="icon" href="../img/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.1">
    
    
      
        <title>Developer's Guide - Mainflux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e8d9bf0c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developers-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Mainflux" class="md-header__button md-logo" aria-label="Mainflux" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mainflux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developer's Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mainflux/mainflux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Mainflux" class="md-nav__button md-logo" aria-label="Mainflux" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    Mainflux
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mainflux/mainflux" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../provision/" class="md-nav__link">
        Provision
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../messaging/" class="md-nav__link">
        Messaging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lora/" class="md-nav__link">
        LoRa
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../opcua/" class="md-nav__link">
        OPC-UA
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../edge/" class="md-nav__link">
        Edge
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../groups/" class="md-nav__link">
        Groups
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../bootstrap/" class="md-nav__link">
        Bootstrap
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../twins/" class="md-nav__link">
        Twins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tracing/" class="md-nav__link">
        Tracing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Developer's Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Developer's Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-mainflux" class="md-nav__link">
    Getting Mainflux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building" class="md-nav__link">
    Building
  </a>
  
    <nav class="md-nav" aria-label="Building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-all-services" class="md-nav__link">
    Build All Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-individual-microservice" class="md-nav__link">
    Build Individual Microservice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-dockers" class="md-nav__link">
    Building Dockers
  </a>
  
    <nav class="md-nav" aria-label="Building Dockers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-docker-images-for-development" class="md-nav__link">
    Building Docker images for development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggested-workflow" class="md-nav__link">
    Suggested workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-the-default-docker-compose-configuration" class="md-nav__link">
    Overriding the default docker-compose configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaning-up-your-dockerized-mainflux-setup" class="md-nav__link">
    Cleaning up your dockerized Mainflux setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt-microservice" class="md-nav__link">
    MQTT Microservice
  </a>
  
    <nav class="md-nav" aria-label="MQTT Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protobuf" class="md-nav__link">
    Protobuf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-compiling-for-arm" class="md-nav__link">
    Cross-compiling for ARM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    Running tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nats" class="md-nav__link">
    NATS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    PostgreSQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mainflux-services" class="md-nav__link">
    Mainflux Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
    <nav class="md-nav" aria-label="Events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#things-service" class="md-nav__link">
    Things Service
  </a>
  
    <nav class="md-nav" aria-label="Things Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thing-create-event" class="md-nav__link">
    Thing create event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-update-event" class="md-nav__link">
    Thing update event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-remove-event" class="md-nav__link">
    Thing remove event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-create-event" class="md-nav__link">
    Channel create event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-update-event" class="md-nav__link">
    Channel update event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-remove-event" class="md-nav__link">
    Channel remove event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-thing-to-a-channel-event" class="md-nav__link">
    Connect thing to a channel event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disconnect-thing-from-a-channel-event" class="md-nav__link">
    Disconnect thing from a channel event
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-service" class="md-nav__link">
    Bootstrap Service
  </a>
  
    <nav class="md-nav" aria-label="Bootstrap Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-create-event" class="md-nav__link">
    Configuration create event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-update-event" class="md-nav__link">
    Configuration update event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-remove-event" class="md-nav__link">
    Configuration remove event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-bootstrap-event" class="md-nav__link">
    Thing bootstrap event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-change-state-event" class="md-nav__link">
    Thing change state event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-update-connections-event" class="md-nav__link">
    Thing update connections event
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt-adapter" class="md-nav__link">
    MQTT Adapter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/" class="md-nav__link">
        Benchmark
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-mainflux" class="md-nav__link">
    Getting Mainflux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building" class="md-nav__link">
    Building
  </a>
  
    <nav class="md-nav" aria-label="Building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-all-services" class="md-nav__link">
    Build All Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-individual-microservice" class="md-nav__link">
    Build Individual Microservice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-dockers" class="md-nav__link">
    Building Dockers
  </a>
  
    <nav class="md-nav" aria-label="Building Dockers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-docker-images-for-development" class="md-nav__link">
    Building Docker images for development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggested-workflow" class="md-nav__link">
    Suggested workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-the-default-docker-compose-configuration" class="md-nav__link">
    Overriding the default docker-compose configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleaning-up-your-dockerized-mainflux-setup" class="md-nav__link">
    Cleaning up your dockerized Mainflux setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt-microservice" class="md-nav__link">
    MQTT Microservice
  </a>
  
    <nav class="md-nav" aria-label="MQTT Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protobuf" class="md-nav__link">
    Protobuf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-compiling-for-arm" class="md-nav__link">
    Cross-compiling for ARM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    Running tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nats" class="md-nav__link">
    NATS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    PostgreSQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mainflux-services" class="md-nav__link">
    Mainflux Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
    <nav class="md-nav" aria-label="Events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#things-service" class="md-nav__link">
    Things Service
  </a>
  
    <nav class="md-nav" aria-label="Things Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thing-create-event" class="md-nav__link">
    Thing create event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-update-event" class="md-nav__link">
    Thing update event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-remove-event" class="md-nav__link">
    Thing remove event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-create-event" class="md-nav__link">
    Channel create event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-update-event" class="md-nav__link">
    Channel update event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-remove-event" class="md-nav__link">
    Channel remove event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-thing-to-a-channel-event" class="md-nav__link">
    Connect thing to a channel event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disconnect-thing-from-a-channel-event" class="md-nav__link">
    Disconnect thing from a channel event
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-service" class="md-nav__link">
    Bootstrap Service
  </a>
  
    <nav class="md-nav" aria-label="Bootstrap Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-create-event" class="md-nav__link">
    Configuration create event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-update-event" class="md-nav__link">
    Configuration update event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-remove-event" class="md-nav__link">
    Configuration remove event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-bootstrap-event" class="md-nav__link">
    Thing bootstrap event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-change-state-event" class="md-nav__link">
    Thing change state event
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thing-update-connections-event" class="md-nav__link">
    Thing update connections event
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt-adapter" class="md-nav__link">
    MQTT Adapter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="developers-guide">Developer's guide<a class="headerlink" href="#developers-guide" title="Permanent link">#</a></h1>
<h2 id="getting-mainflux">Getting Mainflux<a class="headerlink" href="#getting-mainflux" title="Permanent link">#</a></h2>
<p>Mainflux source can be found in the official <a href="https://github.com/Mainflux/mainflux">Mainflux GitHub repository</a>. You should fork this repository in order to make changes to the project. The forked version of the repository should be cloned using the following:</p>
<pre><code class="language-bash">git clone &lt;forked repository&gt; $SOMEPATH/mainflux
cd $SOMEPATH/mainflux
</code></pre>
<p><strong>Note:</strong> If your <code>$SOMEPATH</code> is equal to <code>$GOPATH/src/github.com/mainflux/mainflux</code>, make sure that your <code>$GOROOT</code> and <code>$GOPATH</code> do not overlap (otherwise, go modules won't work).</p>
<h2 id="building">Building<a class="headerlink" href="#building" title="Permanent link">#</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h3>
<p>Make sure that you have <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> (version 3.19.1) compiler (<code>protoc</code>) installed.</p>
<p><a href="https://github.com/golang/protobuf">Go Protobuf</a> installation instructions are <a href="https://github.com/golang/protobuf#installation">here</a>.
Go Protobuf uses C bindings, so you will need to install <a href="https://github.com/google/protobuf">C++ protobuf</a> as a prerequisite.
Mainflux uses <code>Protocol Buffers for Go with Gadgets</code> to generate faster marshaling and unmarshaling Go code. Protocol Buffers for Go with Gadgets installation instructions can be found <a href="https://github.com/gogo/protobuf">here</a>.</p>
<p>A copy of <a href="https://golang.org/doc/install">Go</a> (version 1.17.5) and docker template (version 3.7) will also need to be installed on your system.</p>
<p>If any of these versions seem outdated, the latest can always be found in our <a href="https://github.com/mainflux/mainflux/blob/master/scripts/ci.sh">CI script</a>.</p>
<h3 id="build-all-services">Build All Services<a class="headerlink" href="#build-all-services" title="Permanent link">#</a></h3>
<p>Use the <em>GNU Make</em> tool to build all Mainflux services:</p>
<pre><code class="language-bash">make
</code></pre>
<p>Build artifacts will be put in the <code>build</code> directory.</p>
<blockquote>
<p>N.B. All Mainflux services are built as a statically linked binaries. This way they can be portable (transferred to any platform just by placing them there and running them) as they contain all needed libraries and do not relay on shared system libraries. This helps creating <a href="https://hub.docker.com/_/scratch/">FROM scratch</a> dockers.</p>
</blockquote>
<h3 id="build-individual-microservice">Build Individual Microservice<a class="headerlink" href="#build-individual-microservice" title="Permanent link">#</a></h3>
<p>Individual microservices can be built with:</p>
<pre><code class="language-bash">make &lt;microservice_name&gt;
</code></pre>
<p>For example:</p>
<pre><code class="language-bash">make http
</code></pre>
<p>will build the HTTP Adapter microservice.</p>
<h3 id="building-dockers">Building Dockers<a class="headerlink" href="#building-dockers" title="Permanent link">#</a></h3>
<p>Dockers can be built with:</p>
<pre><code class="language-bash">make dockers
</code></pre>
<p>or individually with:</p>
<pre><code class="language-bash">make docker_&lt;microservice_name&gt;
</code></pre>
<p>For example:</p>
<pre><code class="language-bash">make docker_http
</code></pre>
<blockquote>
<p>N.B. Mainflux creates <code>FROM scratch</code> docker containers which are compact and small in size.</p>
<p>N.B. The <code>things-db</code> and <code>users-db</code> containers are built from a vanilla PostgreSQL docker image downloaded from docker hub which does not persist the data when these containers are rebuilt. Thus, <strong>rebuilding of all docker containers with <code>make dockers</code> or rebuilding the <code>things-db</code> and <code>users-db</code> containers separately with <code>make docker_things-db</code> and <code>make docker_users-db</code> respectively, will cause data loss. All your users, things, channels and connections between them will be lost!</strong> As we use this setup only for development, we don't guarantee any permanent data persistence. Though, in order to enable data retention, we have configured persistent volumes for each container that stores some data. If you want to update your Mainflux dockerized installation and want to keep your data, use <code>make cleandocker</code> to clean the containers and images and keep the data (stored in docker persistent volumes) and then <code>make run</code> to update the images and the containers. Check the <a href="#cleaning-up-your-dockerized-mainflux-setup">Cleaning up your dockerized Mainflux setup</a> section for details. Please note that this kind of updating might not work if there are database changes.</p>
</blockquote>
<h4 id="building-docker-images-for-development">Building Docker images for development<a class="headerlink" href="#building-docker-images-for-development" title="Permanent link">#</a></h4>
<p>In order to speed up build process, you can use commands such as:</p>
<pre><code class="language-bash">make dockers_dev
</code></pre>
<p>or individually with</p>
<pre><code class="language-bash">make docker_dev_&lt;microservice_name&gt;
</code></pre>
<p>Commands <code>make dockers</code> and <code>make dockers_dev</code> are similar. The main difference is that building images in the development mode is done on the local machine, rather than an intermediate image, which makes building images much faster. Before running this command, corresponding binary needs to be built in order to make changes visible. This can be done using <code>make</code> or <code>make &lt;service_name&gt;</code> command. Commands <code>make dockers_dev</code> and <code>make docker_dev_&lt;service_name&gt;</code> should be used only for development to speed up the process of image building. <strong>For deployment images, commands from section above should be used.</strong></p>
<h3 id="suggested-workflow">Suggested workflow<a class="headerlink" href="#suggested-workflow" title="Permanent link">#</a></h3>
<p>When the project is first cloned to your system, you will need to make sure and build all of the Mainflux services.</p>
<pre><code class="language-bash">make
make dockers_dev
</code></pre>
<p>As you develop and test changes, only the services related to your changes will need to be rebuilt. This will reduce compile time and create a much more enjoyable development experience.</p>
<pre><code class="language-bash">make &lt;microservice_name&gt;
make docker_dev_&lt;microservice_name&gt;
make run
</code></pre>
<h3 id="overriding-the-default-docker-compose-configuration">Overriding the default docker-compose configuration<a class="headerlink" href="#overriding-the-default-docker-compose-configuration" title="Permanent link">#</a></h3>
<p>Sometimes, depending on the use case and the user's needs it might be useful to override or add some extra parameters to the docker-compose configuration. These configuration changes can be done by specifying multiple compose files with the <a href="https://docs.docker.com/compose/reference/overview/">docker-compose command line option -f</a> as described <a href="https://docs.docker.com/compose/extends/">here</a>.
The following format of the <code>docker-compose</code> command can be used to extend or override the configuration:</p>
<pre><code>docker-compose -f docker/docker-compose.yml -f docker/docker-compose.custom1.yml -f docker/docker-compose.custom2.yml up [-d]
</code></pre>
<p>In the command above each successive file overrides the previous parameters.</p>
<p>A practical example in our case would be to enable debugging and tracing in NATS so that we can see better how are the messages moving around.</p>
<p><code>docker-compose.nats-debugging.yml</code></p>
<pre><code class="language-yaml">version: &quot;3&quot;

services:
  nats:
    command: --debug -DV
</code></pre>
<p>When we have the override files in place, to compose the whole infrastructure including the persistent volumes we can execute:</p>
<pre><code>docker-compose -f docker/docker-compose.yml -f docker/docker-compose.nats-debugging.yml up -d
</code></pre>
<p><strong>Note:</strong> Please store your customizations to some folder outside the Mainflux's source folder and maybe add them to some other git repository. You can always apply your customizations by pointing to the right file using <code>docker-compose -f ...</code>.</p>
<h3 id="cleaning-up-your-dockerized-mainflux-setup">Cleaning up your dockerized Mainflux setup<a class="headerlink" href="#cleaning-up-your-dockerized-mainflux-setup" title="Permanent link">#</a></h3>
<p>If you want to clean your whole dockerized Mainflux installation you can use the <code>make pv=true cleandocker</code> command. Please note that <strong>by default the <code>make cleandocker</code> command will stop and delete all of the containers and images, but NOT DELETE persistent volumes</strong>. If you want to delete the gathered data in the system (the persistent volumes) please use the following command <code>make pv=true cleandocker</code> (pv = persistent volumes). This form of the command will stop and delete the containers, the images and will also delete the persistent volumes.</p>
<h3 id="mqtt-microservice">MQTT Microservice<a class="headerlink" href="#mqtt-microservice" title="Permanent link">#</a></h3>
<p>The MQTT Microservice in Mainflux is special, as it is currently the only microservice written in NodeJS. It is not compiled, but node modules need to be downloaded in order to start the service:</p>
<pre><code>cd mqtt
npm install
</code></pre>
<p>Note that there is a shorthand for doing these commands with <code>make</code> tool:</p>
<pre><code>make mqtt
</code></pre>
<p>After that, the MQTT Adapter can be started from top directory (as it needs to find <code>*.proto</code> files) with:</p>
<pre><code>node mqtt/mqtt.js
</code></pre>
<h4 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">#</a></h4>
<p>Depending on your use case, MQTT topics, message size, the number of clients and the frequency with which the messages are sent it can happen that you experience some problems.</p>
<p>Up until now it has been noticed that in case of high load, big messages and many clients it can happen that the MQTT microservice crashes with the following error:</p>
<pre><code>mainflux-mqtt   | FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - JavaScript heap out of memory
mainflux-mqtt exited with code 137
</code></pre>
<p>This problem is caused the default allowed memory in node (V8). <a href="https://medium.com/tomincode/increasing-nodes-memory-337dfb1a60dd">V8 gives the user 1.7GB per default</a>. To fix the problem you should add the following environment variable <code>NODE_OPTIONS:--max-old-space-size=SPACE_IN_MB</code> in the <a href="https://github.com/mainflux/mainflux/blob/master/docker/aedes.yml#L31">environment section</a> of the aedes.yml configuration. To find the right value for the <code>--max-old-space-size</code> parameter you'll have to experiment a bit depending on your needs.</p>
<p>The Mainflux MQTT service uses the <a href="https://github.com/mcollina/aedes">Aedes MQTT Broker</a> for implementation of the MQTT related things. Therefore, for some questions or problems you can also check out the Aedes's documentation or reach out its contributors.</p>
<h3 id="protobuf">Protobuf<a class="headerlink" href="#protobuf" title="Permanent link">#</a></h3>
<p>If you've made any changes to <code>.proto</code> files, you should call <code>protoc</code> command prior to compiling individual microservices.</p>
<p>To do this by hand, execute:</p>
<pre><code>protoc --gofast_out=plugins=grpc:. *.proto
protoc --gogo_out=plugins=grpc:. broker/*.proto
</code></pre>
<p>A shorthand to do this via <code>make</code> tool is:</p>
<pre><code>make proto
</code></pre>
<blockquote>
<p>N.B. This must be done once at the beginning in order to generate protobuf Go structures needed for the build. However, if you don't change any of <code>.proto</code> files, this step is not mandatory, since all generated files are included in the repository (those are files with <code>.pb.go</code> extension).</p>
</blockquote>
<h3 id="cross-compiling-for-arm">Cross-compiling for ARM<a class="headerlink" href="#cross-compiling-for-arm" title="Permanent link">#</a></h3>
<p>Mainflux can be compiled for ARM platform and run on Raspberry Pi or other similar IoT gateways, by following the instructions <a href="https://dave.cheney.net/2015/08/22/cross-compilation-with-go-1-5">here</a> or <a href="https://www.alexruf.net/golang/arm/raspberrypi/2016/01/16/cross-compile-with-go-1-5-for-raspberry-pi.html">here</a> as well as information
found <a href="https://github.com/golang/go/wiki/GoArm">here</a>. The environment variables <code>GOARCH=arm</code> and <code>GOARM=7</code> must be set for the compilation.</p>
<p>Cross-compilation for ARM with Mainflux make:</p>
<pre><code>GOOS=linux GOARCH=arm GOARM=7 make
</code></pre>
<h2 id="running-tests">Running tests<a class="headerlink" href="#running-tests" title="Permanent link">#</a></h2>
<p>To run all of the tests you can execute:</p>
<pre><code>make test
</code></pre>
<p>Dockertest is used for the tests, so to run them, you will need the Docker daemon/service running.</p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">#</a></h2>
<p>Installing Go binaries is simple: just move them from <code>build</code> to <code>$GOBIN</code> (do not fortget to add <code>$GOBIN</code> to your <code>$PATH</code>).</p>
<p>You can execute:</p>
<pre><code>make install
</code></pre>
<p>which will do this copying of the binaries.</p>
<blockquote>
<p>N.B. Only Go binaries will be installed this way. The MQTT adapter is a NodeJS script and will stay in the <code>mqtt</code> dir.</p>
</blockquote>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">#</a></h2>
<h3 id="prerequisites_1">Prerequisites<a class="headerlink" href="#prerequisites_1" title="Permanent link">#</a></h3>
<p>Mainflux depends on several infrastructural services, notably <a href="https://www.nats.io/">NATS</a> broker and <a href="https://www.postgresql.org/">PostgreSQL</a> database.</p>
<h4 id="nats">NATS<a class="headerlink" href="#nats" title="Permanent link">#</a></h4>
<p>Mainflux uses NATS as it's central message bus. For development purposes (when not run via Docker), it expects that NATS is installed on the local system.</p>
<p>To do this execute:</p>
<pre><code>go get github.com/nats-io/gnatsd
</code></pre>
<p>This will install <code>gnatsd</code> binary that can be simply run by executing:</p>
<pre><code>gnatsd
</code></pre>
<h4 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">#</a></h4>
<p>Mainflux uses PostgreSQL to store metadata (<code>users</code>, <code>things</code> and <code>channels</code> entities alongside with authorization tokens).
It expects that PostgreSQL DB is installed, set up and running on the local system.</p>
<p>Information how to set-up (prepare) PostgreSQL database can be found <a href="https://support.rackspace.com/how-to/postgresql-creating-and-dropping-roles/">here</a>,
and it is done by executing following commands:</p>
<pre><code># Create `users` and `things` databases
sudo -u postgres createdb users
sudo -u postgres createdb things

# Set-up Postgres roles
sudo su - postgres
psql -U postgres
postgres=# CREATE ROLE mainflux WITH LOGIN ENCRYPTED PASSWORD 'mainflux';
postgres=# ALTER USER mainflux WITH LOGIN ENCRYPTED PASSWORD 'mainflux';
</code></pre>
<h3 id="mainflux-services">Mainflux Services<a class="headerlink" href="#mainflux-services" title="Permanent link">#</a></h3>
<p>Running of the Mainflux microservices can be tricky, as there is a lot of them and each demand configuration in the form of environment variables.</p>
<p>The whole system (set of microservices) can be run with one command:</p>
<pre><code>make rundev
</code></pre>
<p>which will properly configure and run all microservices.</p>
<p>Please assure that MQTT microservice has <code>node_modules</code> installed, as explained in <em>MQTT Microservice</em> chapter.</p>
<blockquote>
<p>N.B. <code>make rundev</code> actually calls helper script <code>scripts/run.sh</code>, so you can inspect this script for the details.</p>
</blockquote>
<h2 id="events">Events<a class="headerlink" href="#events" title="Permanent link">#</a></h2>
<p>In order to be easily integratable system, Mainflux is using <a href="https://redis.io/topics/streams-intro">Redis Streams</a>
as an event log for event sourcing. Services that are publishing events to Redis Streams
are <code>things</code> service, <code>bootstrap</code> service and <code>mqtt</code> adapter.</p>
<h3 id="things-service">Things Service<a class="headerlink" href="#things-service" title="Permanent link">#</a></h3>
<p>For every operation that has side effects (that is changing service state) <code>things</code>
service will generate new event and publish it to Redis Stream called <code>mainflux.things</code>.
Every event has its own event ID that is automatically generated and <code>operation</code>
field that can have one of the following values:
- <code>thing.create</code> for thing creation,
- <code>thing.update</code> for thing update,
- <code>thing.remove</code> for thing removal,
- <code>thing.connect</code> for connecting a thing to a channel,
- <code>thing.disconnect</code> for disconnecting thing from a channel,
- <code>channel.create</code> for channel creation,
- <code>channel.update</code> for channel update,
- <code>channel.remove</code> for channel removal.</p>
<p>By fetching and processing these events you can reconstruct <code>things</code> service state.
If you store some of your custom data in <code>metadata</code> field, this is the perfect
way to fetch it and process it. If you want to integrate through
<a href="https://github.com/mainflux/mainflux/blob/master/docker/docker-compose.yml">docker-compose.yml</a>
you can use <code>mainflux-es-redis</code> service. Just connect to it and consume events
from Redis Stream named <code>mainflux.things</code>.</p>
<h4 id="thing-create-event">Thing create event<a class="headerlink" href="#thing-create-event" title="Permanent link">#</a></h4>
<p>Whenever thing is created, <code>things</code> service will generate new <code>create</code> event. This
event will have the following format:</p>
<pre><code>1) &quot;1555334740911-0&quot;
2)  1) &quot;operation&quot;
    2) &quot;thing.create&quot;
    3) &quot;name&quot;
    4) &quot;d0&quot;
    5) &quot;id&quot;
    6) &quot;3c36273a-94ea-4802-84d6-a51de140112e&quot;
    7) &quot;owner&quot;
    8) &quot;john.doe@email.com&quot;
    9) &quot;metadata&quot;
   10) &quot;{}&quot;
</code></pre>
<p>As you can see from this example, every odd field represents field name while every
even field represents field value. This is standard event format for Redis Streams.
If you want to extract <code>metadata</code> field from this event, you'll have to read it as
string first and then you can deserialize it to some structured format.</p>
<h4 id="thing-update-event">Thing update event<a class="headerlink" href="#thing-update-event" title="Permanent link">#</a></h4>
<p>Whenever thing instance is updated, <code>things</code> service will generate new <code>update</code> event.
This event will have the following format:</p>
<pre><code>1) &quot;1555336161544-0&quot;
2) 1) &quot;operation&quot;
   2) &quot;thing.update&quot;
   3) &quot;name&quot;
   4) &quot;weio&quot;
   5) &quot;id&quot;
   6) &quot;3c36273a-94ea-4802-84d6-a51de140112e&quot;
</code></pre>
<p>Note that thing update event will contain only those fields that were updated using
update endpoint.</p>
<h4 id="thing-remove-event">Thing remove event<a class="headerlink" href="#thing-remove-event" title="Permanent link">#</a></h4>
<p>Whenever thing instance is removed from the system, <code>things</code> service will generate and
publish new <code>remove</code> event. This event will have the following format:</p>
<pre><code>1) 1) &quot;1555339313003-0&quot;
2) 1) &quot;id&quot;
   2) &quot;3c36273a-94ea-4802-84d6-a51de140112e&quot;
   3) &quot;operation&quot;
   4) &quot;thing.remove&quot;
</code></pre>
<h4 id="channel-create-event">Channel create event<a class="headerlink" href="#channel-create-event" title="Permanent link">#</a></h4>
<p>Whenever channel instance is created, <code>things</code> service will generate and publish new
<code>create</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555334740918-0&quot;
2) 1) &quot;id&quot;
   2) &quot;16fb2748-8d3b-4783-b272-bb5f4ad4d661&quot;
   3) &quot;owner&quot;
   4) &quot;john.doe@email.com&quot;
   5) &quot;operation&quot;
   6) &quot;channel.create&quot;
   7) &quot;name&quot;
   8) &quot;c1&quot;
</code></pre>
<h4 id="channel-update-event">Channel update event<a class="headerlink" href="#channel-update-event" title="Permanent link">#</a></h4>
<p>Whenever channel instance is updated, <code>things</code> service will generate and publish new
<code>update</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555338870341-0&quot;
2) 1) &quot;name&quot;
   2) &quot;chan&quot;
   3) &quot;id&quot;
   4) &quot;d9d8f31b-f8d4-49c5-b943-6db10d8e2949&quot;
   5) &quot;operation&quot;
   6) &quot;channel.update&quot;
</code></pre>
<p>Note that update channel event will contain only those fields that were updated using
update channel endpoint.</p>
<h4 id="channel-remove-event">Channel remove event<a class="headerlink" href="#channel-remove-event" title="Permanent link">#</a></h4>
<p>Whenever channel instance is removed from the system, <code>things</code> service will generate and
publish new <code>remove</code> event. This event will have the following format:</p>
<pre><code>1) 1) &quot;1555339429661-0&quot;
2) 1) &quot;id&quot;
   2) &quot;d9d8f31b-f8d4-49c5-b943-6db10d8e2949&quot;
   3) &quot;operation&quot;
   4) &quot;channel.remove&quot;
</code></pre>
<h4 id="connect-thing-to-a-channel-event">Connect thing to a channel event<a class="headerlink" href="#connect-thing-to-a-channel-event" title="Permanent link">#</a></h4>
<p>Whenever thing is connected to a channel on <code>things</code> service, <code>things</code> service will
generate and publish new <code>connect</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555334740920-0&quot;
2) 1) &quot;chan_id&quot;
   2) &quot;d9d8f31b-f8d4-49c5-b943-6db10d8e2949&quot;
   3) &quot;thing_id&quot;
   4) &quot;3c36273a-94ea-4802-84d6-a51de140112e&quot;
   5) &quot;operation&quot;
   6) &quot;thing.connect&quot;
</code></pre>
<h4 id="disconnect-thing-from-a-channel-event">Disconnect thing from a channel event<a class="headerlink" href="#disconnect-thing-from-a-channel-event" title="Permanent link">#</a></h4>
<p>Whenever thing is disconnected from a channel on <code>things</code> service, <code>things</code> service
will generate and publish new <code>disconnect</code> event. This event will have the following
format:</p>
<pre><code>1) &quot;1555334740920-0&quot;
2) 1) &quot;chan_id&quot;
   2) &quot;d9d8f31b-f8d4-49c5-b943-6db10d8e2949&quot;
   3) &quot;thing_id&quot;
   4) &quot;3c36273a-94ea-4802-84d6-a51de140112e&quot;
   5) &quot;operation&quot;
   6) &quot;thing.disconnect&quot;
</code></pre>
<blockquote>
<p><strong>Note:</strong> Every one of these events will omit fields that were not used or are not
relevant for specific operation. Also, field ordering is not guaranteed, so DO NOT
rely on it.</p>
</blockquote>
<h3 id="bootstrap-service">Bootstrap Service<a class="headerlink" href="#bootstrap-service" title="Permanent link">#</a></h3>
<p>Bootstrap service publishes events to Redis Stream called <code>mainflux.bootstrap</code>.
Every event from this service contains <code>operation</code> field which indicates one of
the following event types:
- <code>config.create</code> for configuration creation,
- <code>config.update</code> for configuration update,
- <code>config.remove</code> for configuration removal,
- <code>thing.bootstrap</code> for device bootstrap,
- <code>thing.state_change</code> for device state change,
- <code>thing.update_connections</code> for device connection update.</p>
<p>If you want to integrate through
<a href="https://github.com/mainflux/mainflux/blob/master/docker/addons/bootstrap/docker-compose.yml">docker-compose.yml</a>
you can use <code>mainflux-es-redis</code> service. Just connect to it and consume events
from Redis Stream named <code>mainflux.bootstrap</code>.</p>
<h4 id="configuration-create-event">Configuration create event<a class="headerlink" href="#configuration-create-event" title="Permanent link">#</a></h4>
<p>Whenever configuration is created, <code>bootstrap</code> service will generate and publish
new <code>create</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555404899581-0&quot;
2)  1) &quot;owner&quot;
    2) &quot;john.doe@email.com&quot;
    3) &quot;name&quot;
    4) &quot;some&quot;
    5) &quot;channels&quot;
    6) &quot;ff13ca9c-7322-4c28-a25c-4fe5c7b753fc, c3642289-501d-4974-82f2-ecccc71b2d82, c3642289-501d-4974-82f2-ecccc71b2d83, cd4ce940-9173-43e3-86f7-f788e055eb14&quot;
    7) &quot;externalID&quot;
    8) &quot;9c:b6:d:eb:9f:fd&quot;
    9) &quot;content&quot;
   10) &quot;{}&quot;
   11) &quot;timestamp&quot;
   12) &quot;1555404899&quot;
   13) &quot;operation&quot;
   14) &quot;config.create&quot;
   15) &quot;thing_id&quot;
   16) &quot;63a110d4-2b77-48d2-aa46-2582681eeb82&quot;
</code></pre>
<h4 id="configuration-update-event">Configuration update event<a class="headerlink" href="#configuration-update-event" title="Permanent link">#</a></h4>
<p>Whenever configuration is updated, <code>bootstrap</code> service will generate and publish
new <code>update</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555405104368-0&quot;
2)  1) &quot;content&quot;
    2) &quot;NOV_MGT_HOST: http://127.0.0.1:7000\nDOCKER_MGT_HOST: http://127.0.0.1:2375\nAGENT_MGT_HOST: https://127.0.0.1:7003\nMF_MQTT_HOST: tcp://104.248.142.133:8443&quot;              
    3) &quot;timestamp&quot;
    4) &quot;1555405104&quot;
    5) &quot;operation&quot;
    6) &quot;config.update&quot;
    7) &quot;thing_id&quot;
    8) &quot;63a110d4-2b77-48d2-aa46-2582681eeb82&quot;
    9) &quot;name&quot;
   10) &quot;weio&quot;
</code></pre>
<h4 id="configuration-remove-event">Configuration remove event<a class="headerlink" href="#configuration-remove-event" title="Permanent link">#</a></h4>
<p>Whenever configuration is removed, <code>bootstrap</code> service will generate and publish
new <code>remove</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555405464328-0&quot;
2) 1) &quot;thing_id&quot;
   2) &quot;63a110d4-2b77-48d2-aa46-2582681eeb82&quot;
   3) &quot;timestamp&quot;
   4) &quot;1555405464&quot;
   5) &quot;operation&quot;
   6) &quot;config.remove&quot;
</code></pre>
<h4 id="thing-bootstrap-event">Thing bootstrap event<a class="headerlink" href="#thing-bootstrap-event" title="Permanent link">#</a></h4>
<p>Whenever thing is bootstrapped, <code>bootstrap</code> service will generate and publish
new <code>bootstrap</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555405173785-0&quot;
2) 1) &quot;externalID&quot;
   2) &quot;9c:b6:d:eb:9f:fd&quot;
   3) &quot;success&quot;
   4) &quot;1&quot;
   5) &quot;timestamp&quot;
   6) &quot;1555405173&quot;
   7) &quot;operation&quot;
   8) &quot;thing.bootstrap&quot;
</code></pre>
<h4 id="thing-change-state-event">Thing change state event<a class="headerlink" href="#thing-change-state-event" title="Permanent link">#</a></h4>
<p>Whenever thing's state changes, <code>bootstrap</code> service will generate and publish
new <code>change state</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555405294806-0&quot;
2) 1) &quot;thing_id&quot;
   2) &quot;63a110d4-2b77-48d2-aa46-2582681eeb82&quot;
   3) &quot;state&quot;
   4) &quot;0&quot;
   5) &quot;timestamp&quot;
   6) &quot;1555405294&quot;
   7) &quot;operation&quot;
   8) &quot;thing.state_change&quot;
</code></pre>
<h4 id="thing-update-connections-event">Thing update connections event<a class="headerlink" href="#thing-update-connections-event" title="Permanent link">#</a></h4>
<p>Whenever thing's list of connections is updated, <code>bootstrap</code> service will generate
and publish new <code>update connections</code> event. This event will have the following format:</p>
<pre><code>1) &quot;1555405373360-0&quot;
2) 1) &quot;operation&quot;
   2) &quot;thing.update_connections&quot;
   3) &quot;thing_id&quot;
   4) &quot;63a110d4-2b77-48d2-aa46-2582681eeb82&quot;
   5) &quot;channels&quot;
   6) &quot;ff13ca9c-7322-4c28-a25c-4fe5c7b753fc, 925461e6-edfb-4755-9242-8a57199b90a5, c3642289-501d-4974-82f2-ecccc71b2d82&quot;
   7) &quot;timestamp&quot;
   8) &quot;1555405373&quot;
</code></pre>
<h3 id="mqtt-adapter">MQTT Adapter<a class="headerlink" href="#mqtt-adapter" title="Permanent link">#</a></h3>
<p>Instead of using heartbeat to know when client is connected through MQTT adapter one
can fetch events from Redis Streams that MQTT adapter publishes. MQTT adapter
publishes events every time client connects and disconnects to stream named <code>mainflux.mqtt</code>.</p>
<p>Events that are coming from MQTT adapter have following fields:
- <code>thing_id</code> ID of a thing that has connected to MQTT adapter,
- <code>timestamp</code> is in Epoch UNIX Time Stamp format,
- <code>event_type</code> can have two possible values, connect and disconnect,
- <code>instance</code> represents MQTT adapter instance.</p>
<p>If you want to integrate through
<a href="https://github.com/mainflux/mainflux/blob/master/docker/docker-compose.yml">docker-compose.yml</a>
you can use <code>mainflux-es-redis</code> service. Just connect to it and consume events
from Redis Stream named <code>mainflux.mqtt</code>.</p>
<p>Example of connect event:</p>
<pre><code>1) 1) &quot;1555351214144-0&quot;
2) 1) &quot;thing_id&quot;
   2) &quot;1c597a85-b68e-42ff-8ed8-a3a761884bc4&quot;
   3) &quot;timestamp&quot;
   4) &quot;1555351214&quot;
   5) &quot;event_type&quot;
   6) &quot;connect&quot;
   7) &quot;instance&quot;
   8) &quot;mqtt-adapter-1&quot;
</code></pre>
<p>Example of disconnect event:</p>
<pre><code>1) 1) &quot;1555351214188-0&quot;
2) 1) &quot;thing_id&quot;
   2) &quot;1c597a85-b68e-42ff-8ed8-a3a761884bc4&quot;
   3) &quot;timestamp&quot;
   4) &quot;1555351214&quot;
   5) &quot;event_type&quot;
   6) &quot;disconnect&quot;
   7) &quot;instance&quot;
   8) &quot;mqtt-adapter-1&quot;
</code></pre>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../tracing/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tracing" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Tracing
            </div>
          </div>
        </a>
      
      
        
        <a href="../kubernetes/" class="md-footer__link md-footer__link--next" aria-label="Next: Kubernetes" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Kubernetes
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) Mainflux
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.8aa65030.min.js"></script>
      
    
  </body>
</html>