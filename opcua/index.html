<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://mainfluxlabs.github.io/opcua/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>OPC-UA - Mainflux</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "OPC-UA";
        var mkdocs_page_input_path = "opcua.md";
        var mkdocs_page_url = "/opcua/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Mainflux
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../provision/">Provision</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../messaging/">Messaging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lora/">LoRa</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../edge/">Edge</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../authentication/">Authentication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../authorization/">Authorization</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cli/">CLI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../groups/">Groups</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bootstrap/">Bootstrap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tracing/">Tracing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../dev-guide/">Developer's Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubernetes/">Kubernetes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmark/">Benchmark</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Mainflux</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">OPC-UA</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="opc-ua">OPC-UA<a class="headerlink" href="#opc-ua" title="Permanent link">#</a></h1>
<p>Bridging with an OPC-UA Server can be done over the <a href="https://github.com/MainfluxLabs/mainflux/tree/master/opcua">opcua-adapter</a>. This service sits between Mainflux and an <a href="https://en.wikipedia.org/wiki/OPC_Unified_Architecture">OPC-UA Server</a> and just forwards the messages from one system to another.</p>
<h2 id="run-opc-ua-server">Run OPC-UA Server<a class="headerlink" href="#run-opc-ua-server" title="Permanent link">#</a></h2>
<p>The OPC-UA Server is used for connectivity layer. It allows various methods to read information from the OPC-UA server and its nodes. The current version of the opcua-adapter still experimental and only <code>Browse</code> and <code>Subscribe</code> methods are implemented.
<a href="https://github.com/node-opcua/node-opcua/wiki/publicly-available-OPC-UA-Servers-and-Clients">Public OPC-UA test servers</a> are available for testing of OPC-UA clients and can be used for development and test purposes.</p>
<h2 id="mainflux-opc-ua-adapter">Mainflux OPC-UA Adapter<a class="headerlink" href="#mainflux-opc-ua-adapter" title="Permanent link">#</a></h2>
<p>Execute the following command from Mainflux project root to run the opcua-adapter:</p>
<pre><code class="language-bash">docker-compose -f docker/addons/opcua-adapter/docker-compose.yml up -d
</code></pre>
<h3 id="route-map">Route Map<a class="headerlink" href="#route-map" title="Permanent link">#</a></h3>
<p>The opcua-adapter use <a href="https://redis.io/">Redis</a> database to create a route-map between Mainflux and an OPC-UA Server. As Mainflux use Things and Channels IDs to sign messages, OPC-UA use node ID (node namespace and node identifier combination) and server URI. The adapter route-map associate a <code>Thing ID</code> with a <code>Node ID</code> and a <code>Channel ID</code> with a <code>Server URI</code>.</p>
<p>The opcua-adapter uses the matadata of provision events emitted by Mainflux system to update its route map. For that, you must provision Mainflux Channels and Things with an extra metadata key in the JSON Body of the HTTP request. It must be a JSON object with key <code>opcua</code> which value is another JSON object. This nested JSON object should contain <code>node_id</code> or <code>server_uri</code> that correspond to an existent OPC-UA <code>Node ID</code> or <code>Server URI</code>:</p>
<p><strong>Channel structure:</strong></p>
<pre><code>{
  &quot;name&quot;: &quot;&lt;channel name&gt;&quot;,
  &quot;metadata:&quot;: {
    &quot;opcua&quot;: {
      &quot;server_uri&quot;: &quot;&lt;Server URI&gt;&quot;
    }
  }
}
</code></pre>
<p><strong>Thing structure:</strong></p>
<pre><code>{
  &quot;name&quot;: &quot;&lt;thing name&gt;&quot;,
  &quot;metadata:&quot;: {
    &quot;opcua&quot;: {
      &quot;node_id&quot;: &quot;&lt;Node ID&gt;&quot;,
    }
  }
}
</code></pre>
<h3 id="browse">Browse<a class="headerlink" href="#browse" title="Permanent link">#</a></h3>
<p>The opcua-adapter exposes a <code>/browse</code> HTTP endpoint accessible with method <code>GET</code> and configurable throw HTTP query parameters <code>server</code>, <code>namespace</code> and <code>identifier</code>. The server URI, the node namespace and the node identifier represent the parent node and are used to fetch the list of available children nodes starting from the given one. By default the root node ID (node namespace and node identifier combination) of an OPC-UA server is <code>ns=0;i=84</code>. It's also the default value used by the opcua-adapter to do the browsing if only the server URI is specified in the HTTP query.</p>
<h3 id="subscribe">Subscribe<a class="headerlink" href="#subscribe" title="Permanent link">#</a></h3>
<p>To create an OPC-UA subscription, user should connect the Thing to the Channel. This will automatically create the connection, enable the redis route-map and run a subscription to the <code>server_uri</code> and <code>node_id</code> defined in the Thing and Channel metadata.</p>
<h3 id="messaging">Messaging<a class="headerlink" href="#messaging" title="Permanent link">#</a></h3>
<p>To forward OPC-UA messages the opcua-adapter subscribes to the Node ID of an OPC-UA Server URI. It verifies the <code>server_uri</code> and the <code>node_id</code> of received messages. If the mapping exists it uses corresponding <code>Channel ID</code> and <code>Thing ID</code> to sign and forwards the content of the OPC-UA message to the Mainflux message broker. If the mapping or the connection between the Thing and the Channel don't exist the subscription stops.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright (c) Mainflux</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/MainfluxLabs/docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
